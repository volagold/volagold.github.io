---
title: All about SQL Queries
date: 2022-05-19 9:00:00 +0800
categories: [Programming]
tags: [sql, database]
image:
  src: /assets/imgs/sql.jpg
  alt: "All about SQL Queries"
  width: 800
  height: 500
math: true
published: false
---

> this is a complete record of SQL queries.

## Select the Data

### Select columns with `select ... from ...`

```sql
select c1, c2, ...
from tb
```

### Filter rows with `where`

```sql
select col1, col2, ...
from tb
where condition
    and/or [operator] col
    and/or …
```

We use *operators* in `where` conditions.

- numerical operators: `=, !=, <, <=,` etc, e.g. `age >= 19`

- `between ... and ...` e.g. `age between 26 and 28` (equivalent to `age>=26 and age<=28`)

- `not between ... and ...`

- `in...` e.g. `type in ('a', 'b', 'c')`

Complete reference of operators:

| Operator               | Description                                 | Example                               |
| ---------------------- | ------------------------------------------- | ------------------------------------- |
| `=`                    | equal to                                    | `col = 'salary'`                      |
| `<>` / `!=`            | not equal to                                | `dept != 'decision'`                  |
| `>`                    | greater than                                | `date > 2022-02-15`                   |
| `<`                    | less than                                   | `price < 500.00`                      |
| `>=`                   | greater than or equal                       | `number >= 2`                         |
| `<=`                   | less than or equal                          | `number <= 2`                         |
| `and`                  | and                                         | `state = 'GA' and amount > 1000;`     |
| `or`                   | or                                          | `state = 'GA' or amount > 1000;`      |
| `[not] between`        | between an inclusive range                  | `price between 100.00 and 500.00`     |
| `[not] like`           | string pattern                              | `name like 'Luca%'`                   |
| `ilike`                | string pattern, ignoring capitalization     | `name like '%cafe%'`                  |
| `[not] in`             | set membership test                         | `col in ('col1', 'col2', 'col3')`     |
| `is [not] null`        | compare to null                             | `address is not null`                 |
| `is [not] true`        | boolean true value test                     | `full_time is true`                   |
| `is not distinct from` | is equal to value or both are nulls         | `name is not distinct from full_name` |
| `as`                   | Rename table or column name. Can be omitted | `select result as r`                  |

### Filter rows with `distinct`, `order by` and `limit`

```sql
select distinct col1, col2, ... 
from tb 
where condition
order by col asc/desc
limit [num] offset [num]
```

### Categorize column values with `case when`

```sql
select 
...
case when [op1] col then output1
     when [op2] col then output2
     when [op3] col then output3
     else ...
end (as col_name)
```

### Select columns from different tables with `join`

```sql
select col, col2, ...
from tb inner/left/right/full join tb2 on tb.id = tb2.id
where condition
...
```

tb

| id  | col   |
| --- | ----- |
| a   | value |
| b   | value |
| c   | value |
| d   | value |
| e   | value |

tb2

| id  | col2  |
| --- | ----- |
| a   | value |
| b   | value |
| x   | value |
| y   | value |

#### select row intersection with `inner`

`inner` means tb $\cap$ tb2.

| id  | col   | col2  |
| --- | ----- | ----- |
| a   | value | value |
| b   | value | value |

#### select rows from one table with `left` or `right`

`left` means tb.

| id  | col   | col2   |
| --- | ----- | ------ |
| a   | value | value  |
| b   | value | value  |
| c   | value | `null` |
| d   | value | `null` |
| e   | value | `null` |

`right` means tb2.

| id  | col    | col2  |
| --- | ------ | ----- |
| a   | value  | value |
| b   | value  | value |
| x   | `null` | value |
| y   | `null` | value |

#### select row union with `full`

`full` means tb $\cup$ tb2.

| id  | col    | col2   |
| --- | ------ | ------ |
| a   | value  | value  |
| b   | value  | value  |
| c   | value  | `null` |
| d   | value  | `null` |
| e   | value  | `null` |
| x   | `null` | value  |
| y   | `null` | value  |

> The `outer` keyword is deprecated. It is kept for backward compatibility with SQL-92 only.
> {: .prompt-info }

> In real work you may use (inner) `join` most of the time. `left join` is not very efficient.
> {: .prompt-info }

### Calculating statistics with aggregate functions

```sql
select agg(col) as ...
from tb
where condition
```

| function     | description               |
| ------------ | ------------------------- |
| `count(col)` | counts the number of rows |
| `min(col)`   | min for all rows          |
| `max(col)`   | max for all rows          |
| `avg(col)`   | average for all rows      |
| `sum(col)`   | sum of all rows           |

### Apply aggregate funcitons to different groups of rows with `group by`

Instead of aggregating across ***all*** the rows, you can also apply the aggregate functions to different ***groups*** of rows with `group by`.

```sql
select agg(col) as ...
from tb
where condition
group by col
```

Rows are classified by labels in `col`. In other words, rows that correspond to the same label in `col` belong to the same group.

#### filter grouped rows with `having`

The `having` keyword is used to filter grouped rows returned by `group by`. If you do not use `group by`, then  a simple `where` clause will suffice.

```sql
group by col
having condition
```







zcasfasfasf

<hr>
Cite as:

```bibtex
@article{lifei2022sql,
  title   = "{{ page.title }}",
  author  = "Li, Fei",
  journal = "www.lifei.tech",
  year    = "2022",
  url     = "{{ page.url | absolute_url }}"
}
```
